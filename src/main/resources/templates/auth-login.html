<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
    <head>
        <title>Login</title>
        <link rel="stylesheet" th:href="@{/css/auth-login}">
    </head>
    <body>
        <h1>Login</h1>
        <form id="loginForm">
            <div>
                <label for="username">Username</label>
                <input id="username" type="text" name="Username" placeholder="Username">
            </div>
            <div>
                <label for="email">Email</label>
                <input id="email" type="text" name="email" placeholder="Email">
            </div>
            <div>
                <label for="password">Password</label>
                <input id="password" type="password" name="password" placeholder="password">
            </div>
            <button type="submit">Login</button>
        </form>

        <!-- This script was made by AI, I don't know Javascript -->
        <script>
            document.getElementById("loginForm").addEventListener("submit", function(e) {
                e.preventDefault(); // prevent normal form submission
    
                const name = document.getElementById("username").value;
                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;
    
                fetch("/tokenGeneration", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ name, email, password })
                })
                .then(response => {
                    if (!response.ok) throw new Error("Login failed");
                    return response.json();
                })
                .then(data => {
                    const token = data.token;
                    console.log("JWT token:", token);
    
                    // Save token in localStorage or sessionStorage
                    localStorage.setItem("jwtToken", token);
    
                    // Redirect or fetch protected data
                    window.location.href = "/home/auth"; // for example
                })
                .catch(error => {
                    alert("Authentication failed: " + error.message);
                });

                fetch("/home/auth", {
                    method: "GET",
                    headers: {
                        "Authorization": "Bearer " + localStorage.getItem("jwtToken")
                    }
                });
            });
        </script>
    </body>
</html>